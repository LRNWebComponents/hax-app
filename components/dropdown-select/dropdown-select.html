<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">

<!--
`dropdown-select`
A LRN element

@demo demo/index.html

@microcopy - the mental model for this element
 -
 -
 -

-->

<dom-module id="dropdown-select">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <paper-dropdown-menu id="menu" label$="[[label]]" on-selected-item-changed="_setSelectedValue">
      <paper-listbox id="listbox" slot="dropdown-content" selected$="[[selectedIndex]]">
        <slot></slot>
      </paper-listbox>
    </paper-dropdown-menu>
  </template>

  <script>
    Polymer({

      is: 'dropdown-select',
      /*listeners: {
        'menubutton.tap': '_menubuttonTap',
      },*/
      properties: {
        /** 
         * The label of the select menu
         */
        label: {
          type: String,
          value: 'Select an option.'
        },
        /** 
         * The default value
         */
        value: {
          type: String,
          value: null
        },
        /** 
         * The index of the selected item
         */
        selectedIndex: {
          type: Number,
          reflectToAttribute: true,
          notify: true,
          computed: '_getSelectedIndex(value)',
        }
      },
      /**
       * Get the value of the selected item.
       */
      _setSelectedValue: function(e) {
        if (e.detail.value !== null){
          let val = e.detail.value.getAttribute('value');
          this.setAttribute('value',val);
          this.fire('change',{'value': val});
        }
      },
      /**
       * Get the index of the default value.
       */
      _getSelectedIndex: function(value) {
        this.__items = this.$$('#listbox').getElementsByTagName('paper-item');
        for (var i=0; i<this.__items.length;i++){
          if (value==this.__items[i].getAttribute('value')) {
            return i;
          }
        }
        return null;
      },

    });
  </script>
</dom-module>
